<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Mensagens Recebidas</title>
    <style>
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        .nao-visualizada { font-weight: bold; background-color: #f9f9f9; }
        .visualizada { font-weight: normal; }
        button { margin: 2px; padding: 4px 8px; cursor: pointer; }
        .btn-excluir { background-color: #ff4444; color: white; border: none; }
        .btn-visualizada { background-color: #44aa44; color: white; border: none; }
    </style>
</head>
<body>
    <h2>Mensagens Recebidas</h2>
    <table id="tabelaMensagens">
        <thead>
            <tr>
                <th>Nome</th>
                <th>Email</th>
                <th>Mensagem</th>
                <th>Data</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody id="corpoTabela">
        </tbody>
    </table>

    <script src="js/jquery-3.6.4.min.js"></script>
    <script src="js/api.js"></script>
    <script>
        function carregarMensagens() {
            var mensagens = obterMensagens();
            var tbody = $('#corpoTabela');
            tbody.empty();

            if (mensagens.length === 0) {
                tbody.append('<tr><td colspan="5">Nenhuma mensagem encontrada.</td></tr>');
                return;
            }

            mensagens.forEach(function(msg, index) {
                var isVisualizada = msg.visualizada || false;
                var classe = isVisualizada ? 'visualizada' : 'nao-visualizada';
                var textoBotao = isVisualizada ? 'Reverter Visualização' : 'Marcar como Visualizada';
                
                var linha = $('<tr>').addClass(classe);
                linha.append('<td>' + (msg.nome || 'N/A') + '</td>');
                linha.append('<td>' + (msg.email || 'N/A') + '</td>');
                linha.append('<td>' + (msg.mensagem || 'N/A') + '</td>');
                linha.append('<td>' + (msg.data || 'N/A') + '</td>');
                
                var colunaAcoes = $('<td>');
                
                // Botão Excluir
                var btnExcluir = $('<button>')
                    .addClass('btn-excluir')
                    .text('Excluir')
                    .click(function() {
                        excluirMensagem(index);
                    });
                
                // Botão Marcar como Visualizada
                var btnVisualizada = $('<button>')
                    .addClass('btn-visualizada')
                    .text(textoBotao)
                    .click(function() {
                        marcarComoVisualizada(index);
                    });
                
                colunaAcoes.append(btnExcluir);
                colunaAcoes.append(btnVisualizada);
                linha.append(colunaAcoes);
                
                tbody.append(linha);
            });
        }

        function excluirMensagem(indice) {
            if (confirm("Tem certeza que deseja excluir esta mensagem?")) {
                var mensagens = obterMensagens();
                if (mensagens[indice]) {
                    mensagens.splice(indice, 1);
                    // Atualizar no localStorage (simulação)
                    localStorage.setItem('mensagens', JSON.stringify(mensagens));
                    carregarMensagens();
                    alert("Mensagem excluída com sucesso!");
                }
            }
        }

        function marcarComoVisualizada(indice) {
            if (confirm("Deseja marcar esta mensagem como visualizada?")) {
                var mensagens = obterMensagens();
                if (mensagens[indice]) {
                    mensagens[indice].visualizada = !mensagens[indice].visualizada;
                    // Atualizar no localStorage (simulação)
                    localStorage.setItem('mensagens', JSON.stringify(mensagens));
                    carregarMensagens();
                }
            }
        }

        $(document).ready(function() {
            carregarMensagens();
            
            // Atualizar a cada 5 segundos para novas mensagens
            setInterval(carregarMensagens, 5000);
        });
    </script>
</body>
</html>